{{ define "main" }}
  <section>
    <article class="font-geist">
      <h1 class="!my-0 !mb-4 font-semibold">{{ .Title }}</h1>

      <p class="mb-4 text-neutral-600 italic">
        Showing <span id="commit-toggle-state">latest 10</span> commits â€”
        <button
          id="toggle-button"
          class="cursor-pointer text-red-600 underline hover:text-red-800"
        >
          Show all
        </button>
      </p>

      <div data-pagefind-ignore id="changelog-entries">
        {{ $lines := split (readFile "data/changelog.log") "\n" }}
        {{ range $i, $line := $lines }}
          {{ $parts := split $line " | " }}
          {{ if eq (len $parts) 3 }}
            <div
              class="changelog-entry {{ if gt $i 9 }}
                hidden
              {{ end }} mb-1 flex gap-4"
            >
              <span class="shrink-0 text-neutral-900/50"
                >{{ index $parts 0 }}</span
              >
              <span class="shrink-0 text-red-800">{{ index $parts 1 }}</span>
              <span class="text-neutral-900">{{ index $parts 2 }}</span>
            </div>
          {{ end }}
        {{ end }}
      </div>
    </article>

    <!-- Show All Function -->
    <script>
      const toggleBtn = document.getElementById("toggle-button");
      const entries = document.querySelectorAll(".changelog-entry");
      const stateText = document.getElementById("commit-toggle-state");
      let showingAll = false;

      toggleBtn.addEventListener("click", () => {
        showingAll = !showingAll;
        entries.forEach((entry, idx) => {
          if (idx >= 10) {
            entry.classList.toggle("hidden", !showingAll);
          }
        });
        toggleBtn.textContent = showingAll ? "Show latest 10" : "Show all";
        stateText.textContent = showingAll ? "all" : "latest 10";
      });
    </script>
  </section>
{{ end }}
