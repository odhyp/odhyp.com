<nav id="toc" class="not-prose font-inter sticky top-16">
  {{ .TableOfContents }}
</nav>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tocLinks = document.querySelectorAll("#toc a");
    const headingLinks = Array.from(tocLinks).map((link) =>
      document.querySelector(decodeURIComponent(link.getAttribute("href"))),
    );

    const setActive = () => {
      let index = headingLinks.findIndex((el, i) => {
        if (!el) return false;
        const next = headingLinks[i + 1];
        return (
          window.scrollY >= el.offsetTop - 120 &&
          (!next || window.scrollY < next.offsetTop - 120)
        );
      });

      tocLinks.forEach((link) => link.classList.remove("active"));
      if (index >= 0 && tocLinks[index]) {
        tocLinks[index].classList.add("active");
      }
    };

    window.addEventListener("scroll", setActive);
    setActive();
  });
</script>
