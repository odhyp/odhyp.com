{{- $authorEmail := "" -}}
{{- $authorName := "" -}}
{{- with site.Params.author -}}
  {{- if reflect.IsMap . -}}
    {{- with .email }}{{ $authorEmail = . }}{{ end -}}
    {{- with .name }}{{ $authorName = . }}{{ end -}}
  {{- else -}}
    {{- $authorName = . -}}
  {{- end -}}
{{- end -}}

{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>{{ .Site.Title }}</title>
    <link>{{ .Permalink }}</link>
    <description>{{ site.Params.description }}</description>
    <language>{{ site.Language.LanguageCode }}</language>
    <generator>Hugo</generator>
    <atom:link href="{{ .Permalink }}" rel="self" type="application/rss+xml" />

    {{- range where .Site.RegularPages "Section" "writings" -}}
      <item>
        <title>{{ .Title }}</title>
        <link>{{ .Permalink }}</link>
        <guid isPermaLink="true">{{ .Permalink }}</guid>
        <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</pubDate>
        {{- if and $authorName $authorEmail -}}
        <author>{{ $authorEmail }} ({{ $authorName }})</author>
        {{- else if $authorName -}}
        <author>{{ $authorName }}</author>
        {{- end -}}
        <description>
          {{- if .Summary -}}
            {{ .Summary | transform.XMLEscape }}
          {{- else -}}
            {{ .Plain | truncate 200 | transform.XMLEscape }}
          {{- end -}}
        </description>
      </item>
    {{- end -}}
  </channel>
</rss>
